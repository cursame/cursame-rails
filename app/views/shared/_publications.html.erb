<% wall.each do |publication| %>
<%
  # aqui es inicializan las variables para todos los tipos de publicaciones
  post = publication.publication
  id = publication.id
  publication_cls = 'delivery'
  case publication.publication_type
  when 'Comment'
    avatar = post.user.avatar.modern
    personal_url = post.user.personal_url
    image_avatarxx = post.user.image_avatarxx
    name = post.user.name
    user_name = name 
    content = post.comment_html
    course = post.commentable if post.commentable_type == 'Course'
    if course != nil
    posted_in_for = course.title
    posted_in_for_id = course.id
    end
    ico =''
    tipo = 'Comentario'
  when 'Course'
    avatar = post.avatar.modern
    course_avatarxx = post.course_avatarxx
    name = post.title
    content = post.silabus
    ico = ''
  when 'Discussion'
    avatar = post.user.avatar.modern
    personal_url = post.user.personal_url
    image_avatarxx = post.user.image_avatarxx
    name = post.title
    user_name = post.user.name
    course = post.courses
    posted_in_for = course[0].title if ( !post.courses.blank? )
    posted_in_for_id = course[0].id if ( !post.courses.blank? )
    content = post.description_html 
    ico = '-discussion'
    tipo = 'Discusion'
  when 'Delivery'
    avatar = post.user.avatar.modern
    personal_url = post.user.personal_url
    image_avatarxx = post.user.image_avatarxx
    cargo = post.courses[0]
    name = post.title
    user_name = post.user.name
    course = post.courses
    posted_in_for = course[0].title
    posted_in_for_id = course[0].id
    content = post.description_html
    publication_cls = 'delivery'
    ico = '-homework'
    tipo  = 'Tarea'
  when 'Survey'
    avatar = post.user.avatar.modern
    personal_url = post.user.personal_url
    image_avatarxx = post.user.image_avatarxx
    course = post.courses
    user_name = post.user.name
    posted_in_for = course[0].title
    posted_in_for_id = course[0].id
    name = post.name
    ico = '-survey'
    tipo 'Examen'
  end
  created_at = post.created_at

  type = publication.publication_type
  %>
  <%#= debug personal_url %>

<% if post.state == "published" %>

  <div class="publication-box" id="deleted_id_<%= id %>">

      <%#= debug cargo.publication.comments %>

    <div class="general-cir<%=ico%>"></div>

    <div id = "publication-<%= id %>" class="comment-text <%= publication_cls %>" >
      <div class="arrow-left"></div>
      <div class="header">
        <div class="avatar">
        <% case type %>
        <% when 'Course'%>
          <%= link_to image_tag(avatar,{:class => "avatar-mini"}), course_path(post.id) if ( !avatar.blank? && !nil)%>
         <%= link_to image_tag(course_avatarxx,{:class => "avatar-mini"}), course_path(post.id) if (avatar.blank? || nil)%>
        <%else%>
        <%= link_to image_tag(avatar,{:class => "avatar-mini"}), show_user_path(personal_url) if ( !avatar.blank?  && !nil)%>
        <%= link_to image_tag(image_avatarxx,{:class => "avatar-mini"}), show_user_path(personal_url) if (avatar.blank? || nil)%>
        <%end%>
        </div>

        <div class="top-null-image"></div><% if type != 'Course' %><%= link_to " #{tipo} en el curso: #{posted_in_for}", course_path(posted_in_for_id) if ( !posted_in_for.blank?) %><b> por </b><%= link_to " #{user_name}", show_user_path(personal_url) if ( !user_name.blank?) %>
 <%= link_to "Usuario", show_user_path(personal_url) if ( user_name.blank?) %><%end%><%#= "#{name}" %><span class="date">Creado: <%= created_at.strftime( '%d-%h-%Y %l:%M%P') %></span>
      </div>


      <div class="content">

        <div class="null-image"></div>
        <% case type%>
        <% when 'Discussion'%>
        <p class="title-discusion"><%= name %> </p>
        <!-- <div class="description"><%= content %></div> -->
        <p><%= content %></p>
        <% when 'Course'%>
        <p class="title-discusion"><%= name %></p>
        <!-- <div class="description"><%= content %></div> -->
        <p><%= content %></p>
        <% when 'Comment'%>
        <p><%= content %></p>
        <% when 'Survey'%>
          <%= render :partial => '/shared/survey_publication_tpl', :locals => {:survey => post} %>
        <% when 'Delivery'%>
          <%= render :partial => '/shared/delivery_publication_tpl', :locals => {:delivery => post, :cargo => cargo, :publication => publication} %>
        <%end%>

      </div>


      <!-- footer -->
      <div class="footer" id="footer-publication-<%= id %>">
          <% @vote = publication.publication.votes.up.by_type(User).where(:voter_id => current_user.id)%>
          <% @condition =  @vote[0]%>
          <%if @condition == nil %>
         <div id="liked-<%= publication.id%>">
         <div class="icon like"><%= link_to image_tag('icons/heart-icon-child-comment.png'), upvote_path(publication.id), :remote => true%></div>
         </div>
         <%else%>
         <div id="liked-<%= publication.id%>">
         <div class="icon like"><%= link_to image_tag('icons/heart-icon-child-comment-hover-orange.png'), downvote_path(publication.id), :remote => true%></div>
         </div>
         <%end%>
          <!-- Destroy Wall -->
          <%if publication.publication.owner?(current_role, current_user) then %>
          <%= link_to "Eliminar", destroy_wall_path(publication.id), :remote=>true%>
          <%end%>
          <div class="labels"><%= post.comments.count %> Comentarios</div>
          <div class="labels"><p><div style="float:left" id="counter-like-<%= publication.id%>"><%= publication.publication.votes.up.size %></div> <div style="float:left">&nbsp;me gusta</div></div>
        </div>
      </div>


    <!-- area para comentar -->
    <div class="post-child-comment-box" style="display:block;" id="commentable-area-<%= publication.id %>">
      <div id="comments-publication-<%= publication.id %>" style="display: block;">
        <!-- si el post tiene mas de 3 comentarios -->
        <% if post.comments.count > 3 %>
          <div id="more-comments-<%= id  %>" class="more-comment-box"><span >Ver comentarios anteriores</span> </div>
        <%end%>

        <% post.comments.last(3).each do |commentt| %>
          <%= render :partial => '/shared/comment', :locals => {:comment => commentt} %>
        <%end%>
      </div>
      <div class="user-post-child-comment">
        <%= render :partial => '/shared/form_commentable',:locals => {:commentable_id => post.id,:commentable_type => type} %>
      </div>
    </div>
  </div>
<%end%>
  <script type="text/javascript">
  $('#footer-publication-<%= id %>').on('click',function(e){
    e.preventDefault();
  if(e.target.className === 'icon comments'){ //si quiere ver los comentarios
    alert('comments!!');
  }
  if(e.target.className === 'icon like'){ //si quiere daler like ;)
    alert('like!!');
  }
});

  $('#more-comments-<%= id %>').live('click',function(e){
    $.getScript("<%=request.protocol + request.host_with_port%>/home/load_more_comments/<%= publication.id %>");
    return false;
  });
  </script>
<%end%>
