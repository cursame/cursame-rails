<div class="section-header spaced activities-depot-header">
  <div class="wrapper full-width">

    <div class="section-header-title w-subnav">
      <div class="section-icon">
        <span class="avatar-holder">
          <%= avatar('course', '45', "no", @course.id, "avatar", "no", "no") %>
        </span>
      </div>
      <div class="section-title">
        <h1><%= @course.title %></h1>
        <ul class="section-subnav">
          <li class="active">
            <a class="all_select" href="#" title="Todos" data-filter="all">Todo</a>
          </li>
          <li>
            <a class="homework_select" href="#"  title="Tareas" data-filter="tarea">Tareas</a>
          </li>
          <li>
            <a class="survey_select" href="#"  title="Cuestionarios" data-filter="survey">Cuestionarios</a>  
          </li>
        </ul>
      </div>
    </div>

    <!-- <div class="section-header-actions">
      <div class="membFilter">
        <select id="rtf" value="">
          <option>Todos los miembros</option>
          <% @course.members_in_courses.each do |m|%>
            <option><%= @user=User.find_by_id(m.user_id).name%></option>
          <% end %>
        </select>
      </div>
    </div> -->

  </div>
</div>

<div class="activities-depot-wrap">
  <div class="activities-depot-feeds">
    <div id="activites-feeds-container">

    </div>
    <div id="load-more-activities">
      <%= link_to "Ver mas ...", load_more_activities_path(@course, :per_page => 15, :page => 1), :remote => true%>
    </div>
  </div>
  <div class="activities-depot-main">
    <div class="activity-responds-detail">
      
    </div>
    <div class="activity-responds">

    </div>
  </div>
</div>

<script>

  var feedsURL              = '<%= "#{course_ki_line_pag_path(@course, :per_page => 15, :page => 0) }.json" %>',
      feedsContainer        = $('#activites-feeds-container'),
      feedsDetailContainer  = $('.activities-depot-main'),
      feedRespondsContainer = feedsDetailContainer.find('.activity-responds');

  $.getJSON( feedsURL, function( data ) {
    var activitiesFeeds = data.timeline.date;

    for( var i = 0; i < activitiesFeeds.length; i++ ) {
      var activityFeed = activitiesFeeds[i];

      if ( activityFeed.compose && activityFeed.compose.type == "tarea" || activityFeed.compose.type == "examen") {
          feedsContainer.append( HandlebarsTemplates['activities-depot/feeds']( activityFeed ) );
      }
    }

  });

  feedsContainer.on('click', '.activity-depot-feed', function(event) {
    event.preventDefault();

    var $this         = $(this),
        activityID    = $this.attr('id'),
        activityType  = $this.data('type'),
        url;

    $this.siblings('.activity-depot-feed').removeClass('active');
    $this.addClass('active');

    if ( activityType == "tarea" ) {
      url = '/course_delivery_actdepot/';

    } else if ( activityType == "examen" ) {
      url = '/course_survey_actdepot/';
    }

    $.get( url + activityID );
  });

  feedsDetailContainer.on('click', '.show-activity-delivery', function(event) {
    event.preventDefault();

    var $this         = $(this),
        activityType  = $this.data('type'),
        activityID    = $this.data('id'),
        url;

    if ( activityType == "tarea" ) {
      url = '/course_assignment_l_notif/';
    }

    $.get( url + activityID );
  });

  feedsDetailContainer.on('click', '.show-deliveries-activity', function(event) {
    event.preventDefault();

    var $this = $(this);

    $('.delivery-submited-wrap').remove();
    $('.deliveries-activity-wrap').show();
  });


  // var locuorem = $.getJSON('<%= "#{course_ki_line_pag_path(@course, :per_page => 15, :page => 0) }.json" %>', function(json) {
  //   var timeline = json.timeline.date;
  //   var aux, dd2, flip, kilspace, id, identifier, assets, casual, url, nam, avatar, clasificate;

  //   for(var i = 0; i < timeline.length; i++) {

  //     aux = timeline[i];

  //     if ( aux.compose ) {
  //       kilspace = aux.text.split(' ').join('');
  //       flip = '/assets/' + aux.compose.type + 'roty.png';
  //       id = aux.compose.id + aux.compose.type;
  //       clasificate = aux.compose.clasificate;
  //       as_to_pertence_com_assets = aux.compose.pertencenence_to;

  //       dd2 = aux.asset.credit.split(" ").join("").toLowerCase();
  //       avatar = aux.asset.media || 'http://pruebas.cursa.me/assets/imagex.png';
  //       state =  aux.compose.state;

  //       // genera el publicado y el no publicado
  //       if(state == 'published' && aux.compose.type == 'tarea'){
  //          linkik = '<div id="delivery_state_publish'+aux.compose.id+'">'+ '<a class="state-btn" href="/publish_unpublish_delivery_manualy?state='+state+'&id='+aux.compose.id+'"' + ' ' + 'data-remote="true"> '+'Despublicar'+'</a></div>';
  //        }else if(state == 'published' && aux.compose.type == 'examen'){
  //          linkik = '<div id="survey_state_publish'+aux.compose.id+'">'+ '<a class="state-btn" href="/publish_unpublish_survey_manualy?state='+state+'&id='+aux.compose.id+'"' + ' ' +  'data-remote="true">'+'Despublicar'+'</a></div>';
  //        }else if(state == 'unpublish' && aux.compose.type == 'tarea'){
  //          linkik = '<div id="delivery_state_publish'+aux.compose.id+'">'+ '<a class="state-btn" href="/publish_unpublish_delivery_manualy?state='+state+'&id='+aux.compose.id+'"' + ' ' +  'data-remote="true">'+'Publicar'+'</a></div>';

  //        }else if(state == 'unpublish' && aux.compose.type == 'examen'){
  //           linkik = '<div id="survey_state_publish'+aux.compose.id+'">'+ '<a class="state-btn" href="/publish_unpublish_survey_manualy?state='+state+'&id='+aux.compose.id+'"' + ' ' + 'data-remote="true"> '+'Publicar'+'</a></div>';
  //        }else if(state == 'none' && aux.compose.type == 'entrega_tarea'){
  //           linkik = " ";
  //       }

  //       $('#ajax-dump').append('<div class="activities_depot ' + as_to_pertence_com_assets +' '+ aux.compose.type +'" id="' + id + '"><div class="activity-depot-author"><i class="i i-depot-'+aux.compose.type+'"></i></div> <div class="activity-depot-main"><h6 class="as-link">'+ aux.headline +'</h6><p>' + truncate(aux.text, 50, '...')  +'</p>'+ linkik );
        

  //       // este controlador muestra la informaci√≥n correspondiente a la actividad
  //       $('#' + id).click(function() {
  //         var axelid =  $(this).attr("id");
  //         var cl_actives = $(this).attr("class").split(/\s/);
  //         var last_class = cl_actives[1];
  //         $('.user_assets').hide();
  //         $('.' + last_class).show();

  //         // Se coloca el div para que el usuario vea quien entrego el examen
  //         if(axelid.lastIndexOf("examen") != -1) {
  //           $('#expoced').html('');
  //           $('#expoced').append('<div id="tcg_actdepot" class="tcg"><div id="examenes_contestados" ></div></div>');


  //           $.get('/course_survey_actdepot/' + axelid.replace('examen', ''));
  //         }

  //         // Se coloca el div para que el usuario pueda calificar la tarea
  //         else if(axelid.lastIndexOf("entrega_tarea") != -1) {
  //           $('#expoced').html('');
  //           $('#expoced').append('<div id="tcg_actdepot" class="tcg"><div id="tarea_en_carga_notification"></div></div>');

  //           $.get('/course_assignment_l_notif/' + axelid.replace('entrega_tarea', '') );
  //         }

  //         else if(axelid.lastIndexOf("tarea") != -1) {
  //           $('#expoced').html('');
  //           $('#expoced').append('<div id="tcg_actdepot" class="tcg"><div id="tareas_entregadas"></div></div>');

  //           $.get('/course_delivery_actdepot/' + axelid.replace('tarea', ''));
  //         }          

  //       });
        
  //       casual = "casual" + id;
  //       identifier = '#' + id;

  //       assets = aux.assets;
  //       var cloud = 'po' + aux.asset.credit.split(" ").join("").toLowerCase();
  //       if(assets) {
  //         for(var l = 0; l < assets.length;l++) {
  //          fromk = assets[l];
  //           url = fromk.file.file.url;
  //           nam = fromk.name;
  //           pertence_al = fromk.pertencenence_to;

  //           $("#resonance").prepend('<div style="display:none;" id=' + pertence_al + ' class="user_assets' + cloud + ' ' + pertence_al + '">' + '</div>');
  //           $("#" + pertence_al).prepend('<a href="' + url + '" id=' + id + '>' + nam + '<a>');
  //         }
  //       }
  //     }
  //   }
  // });
  
  function red_actdepot(elem) {
    var red_to = $(elem).attr("redirect_to");
    $(location).attr("href", red_to); 
  }

  $("#rtf").change(function() {         
    var value = $(this).val();
    var flot = value.split(" ").join("").toLowerCase();
    console.log(flot);

    if(flot == ".todaslasactividades") {
      $('.activities_depot').show();
      $('.user_assets').show();
    } else {
      $('.activities_depot').hide();
      $('.user_assets').hide();
      $(flot).show();
    }
  });


  $('.section-subnav li > a').on('click', function() {
    var $this = $(this),
        filter = $this.data('filter');
    
    if ( filter == 'all') {
      feedsContainer.children('.activity-depot-feed').show();  
    } else {
      feedsContainer.children('.activity-depot-feed').hide();
      feedsContainer.children('.' + filter).show();
    }

  });
  
</script>
