<% content_for :body_classes do %>
background-white
<% end %>

<div class="section-header">
  <div class="wrapper spaced">

    <div class="section-header-title no-icon">
      <div class="section-title">
        <h1>Editar Perfil</h1>
      </div>
    </div>
    
  </div>
</div>



<%= form_for(resource, :as => resource_name, :url => registration_path(resource_name), :html => { :method => :put, :class => "default-form user-edit-form"}) do |f| %>

  <div class="wrapper ver-spaced">
    <div class="cols-12">
      <div class="col col-6">

        <%= devise_error_messages! %>
        
        <div class="form-group">
          <div class="form-group-label">
            <%= f.label :Nombre %>
          </div>
          <div class="form-group-main">
            <div class="form-unit">
              <%= f.text_field :first_name %>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="form-group-label">
            <%= f.label :Apellido %>
          </div>
          <div class="form-group-main">
            <div class="form-unit">
              <%= f.text_field :last_name %> 
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="form-group-label">
            <%= f.label :Biografia %>
          </div>
          <div class="form-group-main">
            <div class="form-unit">
              <%= f.text_area :bios, :rows => 6 %>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="form-group-label">
            <%= f.label :Correo_electronico %>
          </div>
          <div class="form-group-main">
            <div class="form-unit">
              <%= f.email_field :email %>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="form-group-label">
            <%= f.label :Twitter_URl %>
          </div>
          <div class="form-group-main">
            <div class="form-unit">
              <%= f.text_field :twitter_link, :class => 'EditUserLabel' %>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="form-group-label">
            <%= f.label :Direccion %>
          </div>
          <div class="form-group-main">
            <div class="form-unit">
              <div class="user-custom-url-wrap">
                <%= icon('green-checkmark') %>
                <%= icon('red-x') %>
                <span>http://cursa.me/users/</span>
                <%= f.text_field :personal_url, :class => 'personal-url' %>
              </div>
              <span id="url-status"></span>
              <p>Recuerda no colocar espacios ni simbolos como (¨,:*`^;/ \) ya que no se aceptará tu url</p>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="form-group-label">
            <%= f.label :nuevo_password %>
          </div>
          <div class="form-group-main">
            <div class="form-unit">
              <%= f.password_field :password, :autocomplete => "off" %>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="form-group-label">
            <%= f.label :confirma_nuevo_password %>
          </div>
          <div class="form-group-main">
            <div class="form-unit">
              <%= f.password_field :password_confirmation  %>
            </div>
          </div>
        </div>
        
        <p>¿Quieres darte de baja? <%= link_to "Cancela tu cuenta", registration_path(resource_name), :data => { :confirm => "Are you sure?" }, :method => :delete %>.</p>
      </div>
      
      <div class="col col-3">
        <div class="profile-images">
          
          <div class="profile-image">
            <span class="avatar-holder">
              <img id="img_prev_user" src="<%= current_user.avatar.profile || current_user.image_avatarx %>" class="avatar avatar-150" />
            </span>

            <label class="btn btn-secondary" >
              Cambiar imagen de perfil
              <span class="hide-input-file">
                <%= f.file_field :avatar, :onchange => "readURL(this,'img_prev_user');" %>
              </span>
            </label>
          </div>

          <div class="profile-image">
            <span class="avatar-holder">
              <img id="img_prev_cover" class="avatar avatar-cover-small" src="<%= current_user.coverphoto || current_user.image_avatarx %>"/>
            </span>

            <label class="btn btn-secondary">
              Cambiar imagen de portada
              <span class="hide-input-file">
                <%= f.file_field :coverphoto, :onchange => "readURL(this,'img_prev_cover');" %>
              </span>
            </label>
          </div>

        </div>
      </div>

    </div>
  </div>

  <div class="wrapper ver-spaced spaced clearfix">
    <div class="fl">
      <%= link_to "Cancelar", :back, class: 'btn btn-secondary' %>
    </div>
    <div class="fr">
      <ul class="list-buttons right">
        <li>
          <%= f.password_field :current_password, :placeholder => 'Escribe tu contraseña para guardar'%>
        </li>
        <li>
          <span class="btn btn-primary input-btn">
            <%= f.submit "Actualizar perfil" %>
          </span>
        </li>
      </ul>
    </div>
  </div>

<% end %>

<script>
  $("#user_personal_url").keyup(function () {
    var value = $(this).val();
    $(this).val(value.replace(/[^a-z0-9]/gi,''));
    var url = '/personlization_url_corroborate/'+value+"";
    $.get(""+url+"");
    
    return
  });

  function readURL(input,id) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();
          var width = $('#'+id).width();
          var height = $('#'+id).height();

          
      reader.onload = function (e) {
        $('#'+id)
        .attr('src', e.target.result)
        .width(width)
        .height(height);
      };

      reader.readAsDataURL(input.files[0]);
    }
  }
</script>