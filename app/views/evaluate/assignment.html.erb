<% assignment = @assignment %>
<% delivery = assignment.delivery %>
<% course = assignment.course %>
<% user = assignment.user %>

<%= render partial: 'evaluate/shared/header_activity_delivery', locals: { delivery: delivery, course: course, meta_data: false } %>

<div class="activity-view-wrap">
  <div class="wrapper">
    <div class="cols-12">
      <div class="col col-8">
        <div class="col-inner">
          <div class="activity-view">

            <div class="activity-view-main">
              <div class="activity-view-main-user">
                <span class="avatar-holder">
                  <%= avatar('user', '45', 'no', user.id, 'avatar avatar-45', 'no', 'no') %>
                </span>
                <div class="activity-view-main-user-state">
                  <h5><%= user.name %></h5>
                  <div class="user-meta">
                    <% if assignment.accomplishment.present? %>
                      <span>Calificación: <%= assignment.accomplishment %></span>
                    <% else %>
                      <span>Sin Calificar</span>
                    <% end %>
                    <span class="mta-spcer">·</span>
                    <span>Entregado: <%= I18n.localize(assignment.created_at, format: "%e de %B del %Y") %></span>
                  </div>
                </div>
              </div>

              <div class="evaluate-user-response tabs">
                <div class="tabs-buttons">
                  <div class="tab active" data-id-target="response">
                    Entrega
                  </div>
                  <div class="tab" data-id-target="response-evaluate">
                    Calificar
                  </div>
                </div>
                <div class="tabs-main">
                  <div id="response" class="activity-response-items tab-content"style="display: none;">
                    <div class="delivery-submited-content">
                      <div class="response-item">
                        <span class="meta-info">Alumno:</span>
                        <p><%= link_to assignment.user.name, show_user_path(assignment.user.personal_url) %></p>
                      </div>
                      <div class="response-item">
                        <span class="meta-info">Titulo:</span>
                        <p><%= assignment.title%></p>
                      </div>
                      <div class="response-item">
                        <span class="meta-info">Mensaje:</span>
                        <p><%= assignment.brief_description%></p>
                      </div>
                      
                      <% if assignment.assets.count > 0 || assignment.contents.count > 0 %>
                        <div class="assets response-item">
                          <span class="meta-info">Archivos adjuntos:</span>
                          <%= render partial: 'assets/assets_list', locals: { assets: assignment.assets, delete_enable: false } %>
                          <%= render :partial => "content/insertions_to_contents", :locals => { :type => assignment, :cl => 'assignment'} %>
                        </div>
                      <% end %>

                    </div>
                  </div>
                  <div id="response-evaluate" class="activity-response-evaluate tab-content" >
                    <div class="delivery-submited-evaluation-fields" id="accomplishment">
                      <%= form_for(assignment, html: { class: 'form-validate-js' }) do |f| %>

                        <div class="activity-set-evaluation">
                          <div class="evaluation-label">
                            <h4>Calificación: *</h4>
                          </div>
                          <div class="evaluation-input">
                            <%= f.fields_for :grade do |grade| %>
                              <%= grade.text_field :score, placeholder: 'Ejemplo: 8', required: true, max: 10, min: 0 %>
                            <% end %>
                          </div>
                        </div>

                        <% if delivery.evaluation_criteria.count > 0 %>
                          <div class="activity-criteria-evaluation">
                            <div class="criteria-evaluation-help-text">
                              <h6>Retroalimentación</h6>
                              <p>Envia comentarios en base a los criterios de evaluación de la discusión.</p>
                              <% delivery.evaluation_criteria.each do |criteria| %>
                                <div class="criteria-evaluation-item">
                                  <h5><%= criteria.name %></h5>
                                  <%= text_area_tag "feedback[#{criteria.name.downcase}]", '', rows: 3, placeholder: 'Retroalimentación' %>
                                </div>
                              <% end %>
                            </div>
                          </div>
                        <% end %>
                        
                        <div class="delivery-submited-evaluation-footer">
                          <div class="fl">
                            <ul class="list-buttons left">
                              <li>
                                <span class="btn btn-primary input-btn">
                                  <%= f.submit "Calificar tarea"%>
                                </span>
                              </li>
                            </ul>
                          </div>
                        </div>
                      <%end%>
                    </div>
                  </div>
                </div>
              </div>

            </div>

          </div>
        </div>
      </div>
      <div class="col col-4">
        <div class="col-inner">
          <div class="sidebar-responses">
            <div class="sidebar-responses-header">
              <h6>Entregas</h6>
            </div>
            <div class="sidebar-responses-main">
              <% delivery.responses.each do |response| %>
                <%= link_to evaluate_delivery_response_path(response) do %> 
                  <div class="sidebar-user-response<%= " active" if assignment.id == response.id %>" >
                    <span class="avatar-holder">
                      <%= avatar('user', '30', 'no', response.user.id, 'avatar avatar-30', 'no', 'no') %>
                    </span>
                    <div class="sidebar-user-response-main">
                      <h6><%= response.user.name %></h6>
                      <% if response.accomplishment %>
                        <span>Calificación: <strong><%= response.accomplishment %></strong></span>
                      <% else %>
                        <span>Sin calificar</span>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>