<% survey = @user_survey %>
<% course = survey.survey.courses.first %>
<% user = survey.user %>

<%= render partial: 'evaluate/shared/header_activity_survey', locals: { survey: survey.survey, course: course, meta_data: true } %>

<div class="activity-view-wrap">
  <div class="wrapper">
    <div class="cols-12">
      <div class="col col-8">
        <div class="col-inner">
          <div class="activity-view">

            <div class="activity-view-main">
              <div class="activity-view-main-user">
                <span class="avatar-holder">
                  <%= avatar('user', '45', 'no', user.id, 'avatar avatar-45', 'no', 'no') %>
                </span>
                <div class="activity-view-main-user-state">
                  <h5><%= user.name %></h5>
                  <div class="user-meta">
                    <span>Obtenido: <%= number_with_precision(survey.evaluation, :precision => 2) %></span>
                    <span class="mta-spcer">Â·</span>
                    <span>Entregado: <%= I18n.localize(survey.created_at, format: "%e de %B del %Y") %></span>
                  </div>
                </div>
              </div>

              <div class="evaluate-user-response tabs">
                <div class="tabs-buttons">
                  <div class="tab active" data-id-target="response">Respuestas</div>
                  <div class="tab" data-id-target="response-evaluate">Comentarios</div>
                </div>
                <div class="tabs-main">
                  <div id="response" class="activity-response-items tab-content">
										<div class="delivery-submited-evaluation-fields">
											<ul class="survey-items-list">


											<% survey.user_survey_responses.each do |response| %>
												<li>
													<div class="survey-item">
														<div class="survey-item-question">
															<p><%= response.question.content%></p>			
														</div>
														<div class="survey-item-answers">
															<span class="meta-info">Respuesta:</span>
										          <div class="survey-item-answer-content">
                                <% response.question.answers.each do |answer| %>
                                  <% if answer.id == response.answer_id %>
                                    <% if answer.correct %>
                                      <%= image_tag('icons/icon_true.png')%>    
                                    <% else %>
                                      <%= image_tag('icons/icon_false.png')%>
                                    <% end %>
                                    <p><%= answer.content %></p>
                                  <% end %>
                                <% end %>
										          </div>
														</div>
													</div>
												</li>
											<% end %>

											</ul>
										</div>
                  </div>
                  <div id="response-evaluate" class="activity-response-evaluate tab-content" style="display: none;">
                    <h5>Escribe un comentario.</h5>
                    <p>Enviar sugerencias al alumno en como mejorar sus entregas.</p>
                    <br>
          					<%= form_tag evaluate_survey_response_update_path(@user_survey) do  %>
            					<%= text_area_tag :feedback, @user_survey.grade.feedback, class: "autogrow" %>
            					<%= hidden_field_tag :id, @user_survey.id %>
                      <span class="btn btn-primary input-btn activable">
                        <%= submit_tag "Enviar comentario", class: "activable"%>
                      </span>
          					<% end %>
                  </div>
                </div>
              </div>

            </div>

          </div>
        </div>
      </div>
      <div class="col col-4">
        <div class="col-inner">
          <div class="sidebar-responses">
            <div class="sidebar-responses-header">
              <h6>Entregas</h6>
            </div>
            <div class="sidebar-responses-main">

              <% survey.survey.responses.each do |response| %>
                <%= link_to evaluate_survey_response_path(response) do %> 
                  <div class="sidebar-user-response<%= " active" if response.id == survey.id %>">
                    <span class="avatar-holder">
                      <%= avatar('user', '30', 'no', response.user.id, 'avatar avatar-30', 'no', 'no') %>
                    </span>
                    <div class="sidebar-user-response-main">
                      <h6><%= response.user.name %></h6>
                      <span>Obtenido: <%= number_with_precision(response.result, :precision => 2) %></span>
                    </div>
                  </div>
                <% end %>
              <% end %>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

