
function renderListItem( ul, item ) {
  var avatarURL;

  if ( item.avatar.head.url ) {
    avatarURL = item.avatar.head.url;
  } else {
    avatarURL = "/assets/imagexxxx.png"
  };
  
  return $( "<li>" ).append( "<a> <img class='avatar' src='" + avatarURL + "' alt=''/>" + item.last_name + " "+ item.first_name + "</a>" ).appendTo( ul );
};

function renderSelectedUser(event, user) {
  var inputOrigin = $(event.target),
      userRole = inputOrigin.data('role'),
      usersList = inputOrigin.closest('div.table-box'),
      userContainer = usersList.find('div.users-list'),
      noContent = usersList.find('div.inner-no-content'),
      users = userContainer.find('div.table-box-unit'),
      already = false;

  console.log(userRole);

  if ( noContent.length ) {
    noContent.remove();
  };

  if ( users.length ) {
    $.each(users, function(index, member) {
      if ( $(member).data('user-id') == user.item.id ) {
        already = true;
        return false;
      };
    });
  };

  if ( already ) {

    if ( userRole == 'teachers') {
      Notice('error', 'El profesor que seleccionaste ya esta en la lista.');
    } else {
      Notice('error', 'El estudiante que seleccionaste ya es miembro.');
    };

  } else {
    userContainer.append( HandlebarsTemplates['users/autocomplete-user-unit']( { user: user, role: userRole } ) );
  };
}

$(function() {

  var messages = { noResults: 'No se encontro nigun estudiante.', results: function() { return ""; } }

  $(  "#students-search-input" ).autocomplete({
    source: '<%= Rails.application.routes.url_helpers.network_students_path %>',
    messages: messages,
    select: renderSelectedUser
  }).data( "autocomplete" )._renderItem = renderListItem;

  $(  "#teachers-search-input" ).autocomplete({
    source: '<%= Rails.application.routes.url_helpers.network_teachers_path %>',
    messages: messages,
    select: renderSelectedUser
  }).data( "autocomplete" )._renderItem = renderListItem;

});